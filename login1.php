<?php
require_once("connnectionMongo.php");	
session_start();

 $vulnerable = true; // SI este parametro esta en TRUE el loguin es vulnerable y si esta en false no lo es.

if (isset($_POST['submit'])) {
	if (empty($_POST['usuario']) || empty($_POST['password'])) {
		$error = "Usuario o password incorrecto";
	} else {
		if($vulnerable){
			$usuario=$_POST['usuario'];
			$password=$_POST['password'];
		}
		else{
			$usuario=(string)$_POST['usuario'];
			$password=(string)$_POST['password'];
		}
		// busco usuario con login y pass
		$user = $collection->findOne(
			[
			  'usuario'  => $usuario,
			  'password' => $password
			]
		);

		// si credenciales correctas se redirige a la pagina del usuario
		if($user) {
			$_SESSION['login_user'] = $user['usuario'];
			header("location: home.php");
			exit();
		} else {
			$error = "Credenciales invalidas. Vuelva a intentarlo.";
		}
	}
}
else $error='';
?>